#!/usr/bin/env zsh
# mx-link
# --------------------------------------------------------------------------------------------------
#
# Description
# -----------
# mx-link will create and link a shared session to the current tmux window
#
# --------------------------------------------------------------------------------------------------
# Authors
# -------
# Filipe Kiss <eu@filipekiss.com.br> http://github.com/filipekiss
# --------------------------------------------------------------------------------------------------

if [[ -z $TMUX ]]; then
    echo "mx-link must be run inside a tmux session"
    exit 0
fi

if ! (tmux has-session -t '_shared' > /dev/null 2>&1); then
    tmux new-session -d -s '_shared' -n 'dotfiles' -x $(tput cols) -y $(tput lines) -c $HOME/.dotfiles
    tmux send-keys -t '_shared' "$EDITOR" C-m
    tmux split-window -h -p 50 -c $HOME/.dotfiles -t '_shared'
fi

if (tmux has-session -t '_shared' > /dev/null 2>&1); then
    _current_session=$(tmux display-message -p '#S');
    tmux link-window -s '_shared:dotfiles' -t "$_current_session" -d > /dev/null 2>&1
fi
