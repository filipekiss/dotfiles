#!/usr/bin/env bash

function __split_args() {
    twidth=$(tput cols)
    theight=$(tput lines)

    # If running this from inside a tmux session, use tmux total width instead of current pane
    # width, which is what tput will provide
    if [[ -n $TMUX ]]; then
        twidth=$(tmux display-message -p '#{window_width}')
        theight=$(tmux display-message -p '#{window_height}')
    fi
    if [[ $twidth -ge 200 ]]; then
        SPLIT_ARGS="-h -l 80"
    elif [[ $twidth -ge 120 ]]; then
        SPLIT_ARGS="-h -p 50"
    fi
    echo $SPLIT_ARGS
}

function __set_size () {
    local size="$1"
    local direction="${2:--H}"
    local currentWidth=$(tput cols)
    local currentHeight=$(tput lines)
    if [[ "-H" == $direction ]]
    then
        if [[ $currentWidth -gt $size ]]
        then
            let "sizeDiff=$currentWidth - $size"
        else
            let "sizeDiff=$size - $currentWidth"
        fi
        direction="-x"
    else
        if [[ $currentHeight -gt $size ]]
        then
            let "sizeDiff=$currentHeight - $size"
        else
            let "sizeDiff=$size - $currentHeight"
        fi
        direction="-y"
    fi
    tmux resize-pane ${direction} ${size}
}

function __current_session() {
    tmux display-message -p '#S'
}

function main() {
    local ACTION
    ACTION=${1:-}
    shift
    case $ACTION in
        split-args)
            __split_args
            ;;
        resize)
            __set_size $@
            ;;
        current-session|current-session-name)
            __current_session
    esac
}

main "$@"
